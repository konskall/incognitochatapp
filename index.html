<!DOCTYPE html>
<html lang="el">
<head>
<link rel="icon" type="image/png" href="https://konskall-ai.github.io/incognitochatapp/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="https://konskall-ai.github.io/incognitochatapp/favicon.svg" />
<link rel="shortcut icon" href="https://konskall-ai.github.io/incognitochatapp/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://konskall-ai.github.io/incognitochatapp/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="Incognito Chat App" />
<link rel="manifest" href="https://konskall-ai.github.io/incognitochatapp/site.webmanifest" />
<!-- Open Graph Tags -->
<meta property="og:title" content="Incognito Chat App - Speak Free">
<meta property="og:description" content="Real-time encrypted chat with PIN-based private rooms. Share freely, anonymously.">
<meta property="og:image" content="https://konskall-ai.github.io/incognitochatapp/og-incognito.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://konskall-ai.github.io/incognitochatapp/index.html">

<!-- Twitter Card Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Incognito Chat App - Speak Free">
<meta name="twitter:description" content="Real-time encrypted chat with PIN-based private rooms.">
<meta name="twitter:image" content="https://konskall-ai.github.io/incognitochatapp/og-incognito.png">

<!-- Greek Localization -->
<meta property="og:locale" content="el_GR">
<meta property="og:locale:alternate" content="en_US">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Incognito Chat App - Speak Free</title>
<style>
 body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  max-width: 700px;
  margin: 0 auto;
  background: #f9fafb;
  padding: 0.5rem;
  color: #222;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

h2 {
  text-align: center;
  color: #3b82f6;
  font-weight: 700;
  font-size: 2rem;
  margin-top: 0.4rem; 
  margin: 0.9rem 0 1.1rem 0; /* Î•Î»Î±Ï‡Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎµÎ½ÏÎ½ Ï€Î¬Î½Ï‰ & ÎºÎ¬Ï„Ï‰ */
  padding: 0;
}

/* Form */
#usernameForm {
display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 1.5rem;
  text-align: center;
  background: rgba(255 255 255 / 0.25);
  backdrop-filter: blur(12px);
  border-radius: 20px;
  padding: 1rem 1.5rem;
  box-shadow: 0 4px 24px rgba(59,130,246,0.2);
}

#usernameInput, #avatarInput {
  padding: 8px 12px;
  font-size: 1rem;
  border: 1.5px solid #3b82f6;
  border-radius: 12px;
  width: 60%;
  margin: 0 10px 10px;
  background: rgba(255 255 255 / 0.9);
  color: #222;
  transition: border-color 0.3s;
}

#usernameInput:focus, #avatarInput:focus {
  outline: none;
  border-color: #2563eb;
}

#saveUsernameBtn {
  background-color: #3b82f6;
  border: none;
  padding: 10px 24px;
  color: white;
  font-weight: 600;
  border-radius: 12px;
  cursor: pointer;
  transition: background-color 0.3s;
}

#saveUsernameBtn:hover {
  background-color: #2563eb;
}

#pinInput {
  padding: 8px 12px;
  font-size: 1rem;
  border: 1.5px solid #3b82f6;
  border-radius: 12px;
  width: 60%;
  margin: 0 10px 10px;
  background: rgba(255 255 255 / 0.9);
  color: #222;
  transition: border-color 0.3s;
}

#pinInput:focus {
  outline: none;
  border-color: #2563eb;
}

/* Chat container */
#chat {
  display: flex;
  flex-direction: column;
  height: 520px;
  border-radius: 24px;
  background: rgba(241,243,245,0.9);
  box-shadow:
    0 4px 20px rgba(0,0,0,0.1);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(59,130,246,0.2);
  overflow: hidden;
}

/* Messages container */
#messages {
  flex: 1;
  overflow-y: auto;
  padding: 2rem;
  scroll-behavior: smooth;
  color: #2c3e50;
  font-size: 1.1rem;
  line-height: 1.3;
  user-select: text;
}

/* Message styles */
.message {
  max-width: 70%;
  margin-bottom: 1.2rem;
  padding: 12px 20px;
  border-radius: 20px;
  display: flex;
  align-items: flex-start;
  word-wrap: break-word;
  transition: background-color 0.3s;
}

.message sent {
  margin-left: auto;
}

.message.sent {
  background: linear-gradient(135deg, #4a90e2, #357abd);
  color: #fff;
  margin-left: auto;
  border-bottom-right-radius: 6px;
  box-shadow:
  0 6px 15px rgba(53,123,189,0.5);
  flex-direction: row-reverse;
  text-align: right;
}

.message.sent .username {
  color: #d9e8ff;
}

.message.received {
  background: #f1f3f5;
  color: #2c3e50;
  margin-right: auto;
  border-bottom-left-radius: 6px;
  box-shadow:
  0 2px 10px rgba(0,0,0,0.05);
}

.message .avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin-right: 12px;
  object-fit: cover;
  box-shadow:
  0 0 10px rgba(0,0,0,0.1);
  flex-shrink: 0;
  
}

.message.sent .avatar {
  margin-left: 12px;
  margin-right: 0;
  box-shadow: 0 0 12px rgba(53,123,189,0.5);
}

.message .username {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 6px;
  user-select: none;
}

/* Message content */
 .messageContent, .message div:last-child {
  flex-grow: 1;
  color: inherit;
    word-break: break-all;
  overflow-wrap: break-word;
  white-space: pre-line;
}

/* Input form container */
#formContainer {
  padding: 1rem 2.5rem;
  border-top: 1px solid rgba(59,130,246,0.3);
  background: #fff;
  display: flex;
  align-items: center;
  border-bottom-left-radius: 24px;
  border-bottom-right-radius: 24px;
  box-shadow: 0 -2px 16px rgba(53,123,189,0.15);
}

/* Textarea message input */
#msgInput {
  flex-grow: 1;
  padding: 12px 16px;
  border-radius: 24px;
  border: 1.5px solid #ced4da;
  font-size: 1.15rem;
  resize: none;
  height: 24px;
  color: #2c3e50;
  transition: border-color 0.3s;
}

#msgInput:focus {
  border-color: #3b82f6;
  outline: none;
}


/* Buttons */
#sendBtn, #emojiBtn {
  background-color: #3b82f6;
  border: none;
  color: white;
  font-weight: 700;
  padding: 8px 22px;
  margin-left: 20px;
  border-radius: 24px;
  cursor: pointer;
  font-size: 1.25rem;
  transition: background-color 0.3s;
  display: flex;
  justify-content: center;
  align-items: center;
}
#emojiBtn svg {
  display: block;
  margin: 0 auto;
  width: 28px;
  height: 28px;
}
#exitChatBtn {
  background-color: #DE5437;
  border: none;
  color: white;
  font-weight: 700;
  padding: 8px 22px;
  margin-left: 20px;
  border-radius: 24px;
  cursor: pointer;
  font-size: 1.25rem;
  transition: background-color 0.3s;
}
#exitChatBtn:hover {
  background-color: #D62909;
}

#sendBtn:hover:enabled, #emojiBtn:hover {
  background-color: #2563eb;
}

#sendBtn:disabled {
  background-color: #93c5fd;
  cursor: not-allowed;
}

/* Emoji picker container */
#emojiPicker {
  position: absolute;
  right: 2rem;
  bottom: 5rem;
  z-index: 9999;
}

/* Responsive */
@media (max-width: 600px) {
  body {
    margin: 0rem;
    padding: 1rem;
  }
  #chat {
    height: 600px;
  }
  h2 {
    font-size: 1.75rem;
	margin-top: 0rem; 
    padding: 0;
  }
  .emoji-picker {
    width: 280px;
    right: 10px;
  }
   .message {
    max-width: 95vw;
  }
  #formContainer {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 10px;
    padding: 1rem;
  }
  #msgInput {
    width: 100% !important;
    min-height: 60px;
    font-size: 1.12rem;
    margin: 0;
    flex: 1 1 100%;
  }
  #sendBtn, #exitChatBtn {
    flex: 1;
    margin: 0;
    border-radius: 18px;
    padding: 13px 0;
    font-size: 1.15rem;
    min-width: 0;
  }
  
   #emojiBtn {
    flex: 1;
    margin: 0;
    border-radius: 18px;
    padding: 13px 0;
    font-size: 1.15rem;
    min-width: 0;
  }
  
   #messageContent, .message div:last-child {
   word-break: break-all;
   overflow-wrap: break-word;
   white-space: pre-line;
  }
  #footer {
    font-size: 0.85rem;
    padding: 0.7rem 0;
  }
  #usernameForm input,
  #saveUsernameBtn {
    width: 98%;
    min-width: 0;
    max-width: 100%;
  }
}
/* Custom Emoji Picker */
.emoji-picker {
  display: none;
  position: absolute;
  bottom: 80px;
  right: 20px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  padding: 1rem;
  width: 320px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
  border: 2px solid #3b82f6;
}

.emoji-picker.show {
  display: block;
}

.emoji-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 8px;
}

.emoji-item {
  font-size: 1.8rem;
  padding: 8px;
  text-align: center;
  cursor: pointer;
  border-radius: 8px;
  transition: background-color 0.2s;
  user-select: none;
}

.emoji-item:hover {
  background-color: #e3f2fd;
  transform: scale(1.1);
}
#footer {
  text-align: center;
  padding: 1rem 0;
  color: #3b82f6;
  font-size: 1rem;
  background: none;
  opacity: 0.8;
}
/* Info Box - Instructions */
#infoBox {
  background: rgba(255, 255, 255, 0.25);
  backdrop-filter: blur(12px);
  border-radius: 20px;
  padding: 1.5rem;
  margin-top: 1rem;
  box-shadow: 0 4px 24px rgba(59, 130, 246, 0.2);
  border: 1px solid rgba(59, 130, 246, 0.15);
  color: #3b82f6;
  font-size: 0.95rem;
  line-height: 1.6;
  animation: slideUp 0.6s ease-out;
}
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#infoBox h3 {
  color: #3b82f6;
  font-weight: 700;
  margin: 0 0 0.8rem 0;
  font-size: 1.1rem;
  text-align: center;
}

#infoBox ul {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: left;
}

#infoBox li {
  margin: 0.6rem 0;
  padding-left: 1.5rem;
  position: relative;
}

#infoBox li:before {
  content: "â–¸";
  position: absolute;
  left: 0;
  color: #3b82f6;
  font-weight: bold;
}

@media (max-width: 600px) {
  #infoBox {
    padding: 1rem;
    margin-top: 1.5rem;
    font-size: 0.9rem;
  }

  #infoBox h3 {
    font-size: 1rem;
  }
   #infoBox li {
    padding-right: 1.2rem;
    margin: 0.5rem 0;
  }
}
/* Delete Button Styling */
#deleteChatBtn {
  background-color: #DE5437;
  border: none;
  color: white;
  font-weight: 700;
  padding: 8px 22px;
  margin-left: 20px;
  border-radius: 24px;
  cursor: pointer;
  font-size: 1.25rem;
  transition: background-color 0.3s, transform 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
}

#deleteChatBtn:hover {
  background-color: #D62909;
  transform: scale(1.05);
}

#deleteChatBtn:active {
  transform: scale(0.98);
}

#deleteChatBtn:disabled {
  background-color: #93c5fd;
  cursor: not-allowed;
  transform: scale(1);
}

/* Mobile Responsive */
@media (max-width: 600px) {
  #deleteChatBtn {
    flex: 1;
    margin: 0;
    border-radius: 18px;
    padding: 13px 0;
    font-size: 1.15rem;
    min-width: 0;
  }
}

/* Confirmation Modal Styles */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.modal.show {
  display: flex;
}

.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
}

.modal-content {
  position: relative;
  background: white;
  border-radius: 20px;
  padding: 2rem;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.3s ease-out;
  text-align: center;
}

.modal-content h3 {
  color: #222;
  font-size: 1.5rem;
  margin: 0 0 1rem 0;
  font-weight: 700;
}

.modal-content p {
  color: #666;
  margin: 0.5rem 0;
  line-height: 1.6;
  text-align: center;
}

.modal-buttons {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  justify-content: center;
}

.modal-buttons button {
  flex: 0 1 auto;
  padding: 12px 24px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  font-size: 1rem;
  transition: all 0.3s;
}

.modal-buttons button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

#confirmDeleteBtn {
  background-color: #DE5437;
  color: white;
}

#confirmDeleteBtn:hover:not(:disabled) {
  background-color: #D62909;
}

#cancelDeleteBtn {
  background-color: #e5e7eb;
  color: #222;
}

#cancelDeleteBtn:hover {
  background-color: #d1d5db;
}

@media (max-width: 600px) {
  .modal-content {
    padding: 1.5rem;
    width: 95%;
  }
  
  .modal-buttons {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .modal-buttons button {
    padding: 14px 0;
  }
}

</style>
</head>
<body>
<h2>Incognito Chat App</h2>
<div id="usernameForm">
  <input id="usernameInput" type="text" placeholder="Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·" maxlength="20" />
  <input id="avatarInput" type="text" placeholder="URL Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚ Ï€ÏÎ¿Ï†Î¯Î» (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)" />
  <input id="pinInput" type="text" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ PIN Î´Ï‰Î¼Î±Ï„Î¯Î¿Ï…" maxlength="12" />
  <button id="saveUsernameBtn">Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
 <div id="infoBox">
  <h3>ğŸ’¡ Quick Guide</h3>
  <ul>
    <li>ğŸ‘¤ <strong>ÎŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î·:</strong> Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î¹ÏƒÎµ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î±ÏÎµÏƒÎºÎµÎ¯Î±Ï‚ ÏƒÎ¿Ï…</li>
    <li>ğŸ“¸ <strong>URL Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚:</strong> Î’Î¬Î»Îµ Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬ Î±Î½ Î¸ÎµÏ‚ Ï„Î¿ link Î¼Î¹Î±Ï‚ ÎµÎ¹ÎºÏŒÎ½Î±Ï‚</li>
    <li>ğŸ” <strong>Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±:</strong> ÎšÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î¼Îµ PIN Î´Ï‰Î¼Î±Ï„Î¯Î¿Ï…</li>
	<li>ğŸšª <strong>ÎÎ­Î¿ Î´Ï‰Î¼Î¬Ï„Î¹Î¿:</strong> Î“Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î´Ï‰Î¼Î±Ï„Î¯Î¿Ï… Ï€Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î¹ÏƒÎµ PIN Ï„Î·Ï‚ Î±ÏÎµÏƒÎºÎµÎ¯Î±Ï‚ ÏƒÎ¿Ï… ÎºÎ±Î¹ Î¼Î¿Î¯ÏÎ±ÏƒÎµ Ï„Î¿</li>
  </ul>
</div>
</div>

<div id="chat" style="display:none;">
  <div id="messages"></div>
  <div class="emoji-picker" id="emojiPicker">
  <div class="emoji-grid" id="emojiGrid"></div>
</div>
  <div id="formContainer">
    <textarea id="msgInput" placeholder="Î“ÏÎ¬ÏˆÎµ Î¼Î®Î½Ï…Î¼Î±..." rows="1"></textarea>
    <button id="sendBtn" disabled>Send</button>
	<button id="emojiBtn" title="Î•Ï€Î¹Î»Î¿Î³Î­Î±Ï‚ Emoji"><svg width="25" height="25" viewBox="0 0 38 38" fill="none">
    <circle cx="19" cy="19" r="16" fill="#FFD966" />
    <ellipse cx="13" cy="16" rx="2" ry="2.5" fill="#222"/>
    <ellipse cx="25" cy="16" rx="2" ry="2.5" fill="#222"/>
    <path d="M12 25 Q19 31 26 25" stroke="#222" stroke-width="2.2" stroke-linecap="round" fill="none"/>
  </svg></button>
	<button id="exitChatBtn">Exit</button>
	<button id="deleteChatBtn" title="Delete entire chat and all messages" style="background-color: #DE5437;">Delete Chat</button>
  </div>
</div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
  apiKey: "AIzaSyCEwq6LnJk5aE7pcVzBZHgwF-9oojJG46Q",
  authDomain: "viberclone-d44c3.firebaseapp.com",
  projectId: "viberclone-d44c3",
  storageBucket: "viberclone-d44c3.firebasestorage.app",
  messagingSenderId: "98425544519",
  appId: "1:98425544519:web:8db7e8dc5068a69d497662",
  measurementId: "G-GX3P2QHXD1"
  };
  // Base64 encode
  function encodeMessage(str) {
  return btoa(unescape(encodeURIComponent(str)));
}
// Base64 decode
function decodeMessage(str) {
  try {
    return decodeURIComponent(escape(atob(str)));
  } catch(e) {
    return str;
  }
}
let beepPrimed = false;
function unlockMobileAudio() {
  if (!beepPrimed && window.AudioContext) {
    try {
      new window.AudioContext().resume();
      beepPrimed = true;
    } catch(e) {}
  }
}
document.body.addEventListener('touchstart', unlockMobileAudio, { once: true });
document.body.addEventListener('click', unlockMobileAudio, { once: true });
function renderRichText(msg) {
  // --- Helper Î³Î¹Î± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± (escape HTML) ---
  const escapeHtml = (text) => text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
  
  // --- Helper Î³Î¹Î± YouTube placeholder ---
  const ytEmbed = (id) => `__YT_EMBED_${id}__`;
  
  // Î ÏÏÏ„Î±: Î±Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· YouTube links Î¼Îµ placeholders (Ï€ÏÎ¹Î½ Ï„Î¿ escape)
  let html = msg;
  
  // 1ï¸âƒ£ YouTube links (watch?v=)
  html = html.replace(
    /https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([A-Za-z0-9_-]{11})(?:[^\s]*)?/g,
    (m, id) => ytEmbed(id)
  );
  
  // 2ï¸âƒ£ YouTube short links (youtu.be)
  html = html.replace(
    /https?:\/\/youtu\.be\/([A-Za-z0-9_-]{11})(?:[^\s]*)?/g,
    (m, id) => ytEmbed(id)
  );
  
  // 3ï¸âƒ£ YouTube Shorts
  html = html.replace(
    /https?:\/\/(?:www\.)?youtube\.com\/shorts\/([A-Za-z0-9_-]{11})(?:[^\s]*)?/g,
    (m, id) => ytEmbed(id)
  );
  
  // Î¤ÏÏÎ±: Escape HTML (ÏÏƒÏ„Îµ Î½Î± Î±Ï€Î¿Ï†ÎµÏ…Ï‡Î¸Î¿ÏÎ½ injections)
  html = escapeHtml(html);
  
  // 4ï¸âƒ£ Î•Î¹ÎºÏŒÎ½ÎµÏ‚
  html = html.replace(
    /https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp)(?:\?[^\s]*)?/gi,
    `<img src="$&" alt="image" style="width:100%;max-width:100%;height:auto;border-radius:12px;margin:0.6em 0;display:block;" />`
  );
  
  // 5ï¸âƒ£ Î¥Ï€ÏŒÎ»Î¿Î¹Ï€Î± URLs â†’ clickable links
  html = html.replace(
    /https?:\/\/[^\s<>"]+/g,
    `<a href="$&" target="_blank" rel="noopener noreferrer" style="color:#3b82f6;text-decoration:underline;">$&</a>`
  );
  
  // 6ï¸âƒ£ Î¤ÎµÎ»Î¹ÎºÏŒ Î²Î®Î¼Î±: Î‘Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· YouTube placeholders Î¼Îµ Ï„Î¿ embed iframe
  html = html.replace(
    /__YT_EMBED_([A-Za-z0-9_-]{11})__/g,
    (m, id) => `
      <div style="margin:0.8em 0;width:100%;">
        <iframe
          width="100%"
          height="220"
          src="https://www.youtube.com/embed/${id}"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          style="border-radius:12px;"
        ></iframe>
      </div>
    `
  );
  
  return html;
}

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  let currentUser = null;
  let username = localStorage.getItem("chatUsername");
  let unsubscribeMessages = null;
  let avatarURL = localStorage.getItem("chatAvatarURL");
  let chatPin = localStorage.getItem("chatPin");
  const usernameForm = document.getElementById("usernameForm");
  const usernameInput = document.getElementById("usernameInput");
  const avatarInput = document.getElementById("avatarInput");
  const saveUsernameBtn = document.getElementById("saveUsernameBtn");
  const chatDiv = document.getElementById("chat");
  const messagesDiv = document.getElementById("messages");
  const msgInput = document.getElementById("msgInput");
  const sendBtn = document.getElementById("sendBtn");
  const emojiBtn = document.getElementById("emojiBtn");
  const exitChatBtn = document.getElementById("exitChatBtn");
exitChatBtn.onclick = () => {
if (unsubscribeMessages) {
  unsubscribeMessages();  // Î£Ï„Î±Î¼Î¬Ï„Î± Ï„Î¿Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ listener Î¬Î¼ÎµÏƒÎ±!
}
  localStorage.removeItem("chatPin");
  chatPin = null;
  chatDiv.style.display = "none";
  usernameForm.style.display = "flex";
  document.getElementById("pinInput").value = "";
};

  if (
  username &&
  chatPin &&
  chatPin.match(/^[\w\d]{4,}$/)
) {
  // Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ username ÎºÎ±Î¹ Î­Î³ÎºÏ…ÏÎ¿ PIN
  usernameForm.style.display = "none";
  chatDiv.style.display = "flex";
  usernameInput.value = username;
  avatarInput.value = avatarURL || "";
  pinInput.value = chatPin;
  startChat();
} else {
  // Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î³ÎºÏ…ÏÎ¿ session â€“ Î±Î½Î¬Î³ÎºÎ±ÏƒÎµ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î½Î± ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÎµÎ¹ PIN
  localStorage.removeItem("chatPin"); // ÎšÎ±Î¸Î±ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ Ï€ÏÎ¿Î²Î»Î·Î¼Î±Ï„Î¹ÎºÏŒ PIN
  chatPin = null;
  usernameForm.style.display = "flex";
  chatDiv.style.display = "none";
  pinInput.value = "";
}

  saveUsernameBtn.onclick = () => {
    const val = usernameInput.value.trim();
    const avatarVal = avatarInput.value.trim();
	const pinVal = pinInput.value.trim();
    if (val.length < 2) {
      alert("Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 2 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚.");
      return;
    }
	if (!pinVal.match(/^[\w\d]{4,}$/)) {
    alert("Î¤Î¿ PIN Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 4 ÏƒÏÎ¼Î²Î¿Î»Î±.");
    return;
  }
    username = val;
    avatarURL = avatarVal;
	chatPin = pinVal;
    localStorage.setItem("chatUsername", username);
    localStorage.setItem("chatAvatarURL", avatarURL);
	localStorage.setItem("chatPin", pinVal);
    usernameForm.style.display = "none";
    chatDiv.style.display = "flex";
    startChat();
  };

  sendBtn.onclick = sendMessage;
  msgInput.addEventListener("input", () => {
    sendBtn.disabled = msgInput.value.trim().length === 0;
    msgInput.style.height = "auto";
    msgInput.style.height = msgInput.scrollHeight + "px";
  });
  msgInput.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      if (!sendBtn.disabled) sendMessage();
    }
  });

  const emojiPicker = document.getElementById("emojiPicker");
  const emojiGrid = document.getElementById("emojiGrid");

// Popular emojis
const emojis = [
  'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚',
  'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©',
  'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜š', 'ğŸ˜™', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª',
  'ğŸ˜', 'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤”', 'ğŸ¤', 'ğŸ¤¨',
  'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ¤¥',
  'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•',
  'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§',
  'ğŸ˜•', 'ğŸ˜Ÿ', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜³',
  'ğŸ¥º', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­',
  'ğŸ˜±', 'ğŸ˜–', 'ğŸ˜£', 'ğŸ˜', 'ğŸ˜“', 'ğŸ˜©', 'ğŸ˜«', 'ğŸ¥±',
  'ğŸ‘', 'ğŸ‘', 'ğŸ‘Œ', 'âœŒï¸', 'ğŸ¤', 'ğŸ¤Ÿ', 'ğŸ¤˜', 'ğŸ¤™',
  'ğŸ‘', 'ğŸ™Œ', 'ğŸ‘', 'ğŸ¤²', 'ğŸ¤', 'ğŸ™', 'âœï¸', 'ğŸ’ª',
  'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤',
  'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜',
  'ğŸ”¥', 'âœ¨', 'ğŸ’«', 'â­', 'ğŸŒŸ', 'ğŸ’¥', 'ğŸ’¯', 'âœ…'
];

// Populate emoji grid
emojis.forEach(emoji => {
  const emojiItem = document.createElement('div');
  emojiItem.className = 'emoji-item';
  emojiItem.textContent = emoji;
  emojiItem.onclick = () => insertEmoji(emoji);
  emojiGrid.appendChild(emojiItem);
});

// Toggle emoji picker
emojiBtn.onclick = (e) => {
  e.stopPropagation();
  emojiPicker.classList.toggle('show');
};

// Close emoji picker when clicking outside
document.addEventListener('click', (e) => {
  if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) {
    emojiPicker.classList.remove('show');
  }
});

function insertEmoji(emoji) {
  const start = msgInput.selectionStart || 0;
  const end = msgInput.selectionEnd || 0;
  const text = msgInput.value;
  msgInput.value = text.substring(0, start) + emoji + text.substring(end);
  msgInput.selectionStart = msgInput.selectionEnd = start + emoji.length;
  msgInput.focus();
  sendBtn.disabled = msgInput.value.trim().length === 0;
  emojiPicker.classList.remove('show');
}

  function startChat() {
  auth.signInAnonymously().catch(console.error);
  auth.onAuthStateChanged(async user => {
    if (user) {
      currentUser = user;
      // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î³Î¹Î± Ï…Ï€Î¬ÏÏ‡Î¿Î½ chat room
      const chatRef = db.collection("chats").doc(chatPin);
      const chatDoc = await chatRef.get();
      if (!chatDoc.exists) {
        await chatRef.set({ createdAt: new Date(), pin: chatPin });
      }
      listenMessages();
    }
  });
}

function listenMessages() {
  let isFirstLoad = true;

  // Î‘Ï€ÎµÎ³ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Ï„Î¿Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ listener Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
  if (unsubscribeMessages) {
    unsubscribeMessages();
  }

  unsubscribeMessages = db.collection("chats").doc(chatPin)
    .collection("messages").orderBy("createdAt")
    .onSnapshot(snapshot => {
      messagesDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const whoSent = data.uid === currentUser.uid ? "sent" : "received";
        messagesDiv.appendChild(createMessageElement(data.text, data.username, data.avatarURL, whoSent));
      });

      // Î Î±Î¯Î¶Î¿Ï…Î¼Îµ Î®Ï‡Î¿ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î½Î­Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± (ÏŒÏ‡Î¹ ÏƒÏ„Î·Î½ Ï€ÏÏÏ„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ·)
      if (!isFirstLoad) {
        snapshot.docChanges().forEach(change => {
          if (change.type === "added") {
            const data = change.doc.data();
            if (data.uid !== currentUser.uid) {
              playBeep();
              if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(120);
              }
            }
          }
        });
      }
      
      isFirstLoad = false;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
}

  function createMessageElement(text, usernameMsg, avatar, sentOrReceived) {
  const msgDiv = document.createElement("div");
  msgDiv.classList.add("message", sentOrReceived);
  const avatarImg = document.createElement("img");
  avatarImg.classList.add("avatar");
  avatarImg.src = avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(usernameMsg)}&background=3b82f6&color=fff&rounded=true`;
  avatarImg.alt = usernameMsg;
  const contentDiv = document.createElement("div");
  contentDiv.classList.add("messageContent");
  const usernameSpan = document.createElement("div");
  usernameSpan.classList.add("username");
  usernameSpan.textContent = usernameMsg;
  const textSpan = document.createElement("div");
  // Î•Î”Î© ÎºÎ¬Î½ÎµÎ¹Ï‚ Ï„Î·Î½ Î±Ï€Î¿ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· ÏƒÏ„Î¿ bubble:
  textSpan.innerHTML = renderRichText(decodeMessage(text));
  contentDiv.appendChild(usernameSpan);
  contentDiv.appendChild(textSpan);
  msgDiv.appendChild(avatarImg);
  msgDiv.appendChild(contentDiv);
  return msgDiv;
}

  async function sendMessage() {
  const text = msgInput.value.trim();
  if (!text) return;
  await db.collection("chats").doc(chatPin)
    .collection("messages").add({
      uid: currentUser.uid,
      username: username,
      avatarURL: avatarURL,
      text: encodeMessage(text),
      createdAt: new Date()
    });
  msgInput.value = "";
  sendBtn.disabled = true;
  msgInput.style.height = "auto";
}
  function playBeep() {
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = ctx.createOscillator();
    const gain = ctx.createGain();
    oscillator.type = 'sine';
    oscillator.frequency.value = 600;
    gain.gain.value = 0.17;
    oscillator.connect(gain);
    gain.connect(ctx.destination);
    oscillator.start();
    oscillator.stop(ctx.currentTime + 0.18);
    oscillator.onended = () => ctx.close();
  } catch (e) {
    console.log('Audio not supported');
  }
}
</script>
<footer id="footer">
<span>Incognito Chat App Â© 2025 â€¢ Powered by <a href="http://linkedin.com/in/konstantinos-kalliakoudis-902b90103" target="_blank" rel="noopener noreferrer" style="color:#3b82f6;">KonsKall</a></span>
</footer>
<!-- Delete Confirmation Modal - Î•Î”Î© Î¤ÎŸ Î’Î‘Î›Î• -->
<div id="deleteConfirmationModal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <h3>âš ï¸ Î”Î¹Î±Î³ÏÎ±Ï†Î® ÏƒÏ…Î½Î¿Î¼Î¹Î»Î¯Î±Ï‚;</h3>
    <p>Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î¸Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ Î¼ÏŒÎ½Î¹Î¼Î± Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ Î´Ï‰Î¼Î¬Ï„Î¹Î¿ ÏƒÏ…Î½Î¿Î¼Î¹Î»Î¯Î±Ï‚ ÎºÎ±Î¹ ÏŒÎ»Î± Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î±..</p>
    <p style="color: #666; font-size: 0.9rem;">âš ï¸ Î‘Ï…Ï„Î® Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¹ÏÎµÎ¸ÎµÎ¯...</p>
    <div class="modal-buttons">
      <button id="cancelDeleteBtn">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
      <button id="confirmDeleteBtn">Î”Î¹Î±Î³ÏÎ±Ï†Î® Chat</button>
    </div>
  </div>
</div>

<!-- Î”Î•Î¥Î¤Î•Î¡ÎŸ SCRIPT - Î“Î™Î‘ Î¤ÎŸ DELETE CODE -->
<script>
// Get modal elements
const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
const deleteChatBtn = document.getElementById('deleteChatBtn');
const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
const modalOverlay = deleteConfirmationModal.querySelector('.modal-overlay');

// Open delete confirmation modal
deleteChatBtn.onclick = () => {
  deleteConfirmationModal.classList.add('show');
};

// Close modal on cancel
cancelDeleteBtn.onclick = () => {
  deleteConfirmationModal.classList.remove('show');
};

// Close modal when clicking overlay
modalOverlay.onclick = () => {
  deleteConfirmationModal.classList.remove('show');
};

// Confirm and execute deletion
confirmDeleteBtn.onclick = async () => {
  if (!chatPin) {
    alert('Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎµÎ½ÎµÏÎ³ÏŒ chat room');
    return;
  }
  
  try {
    confirmDeleteBtn.disabled = true;
    confirmDeleteBtn.textContent = 'â³ Î”Î¹Î±Î³ÏÎ±Ï†Î®...';
    
    const chatRef = db.collection('chats').doc(chatPin);
    const messagesRef = chatRef.collection('messages');
    
    const snapshot = await messagesRef.get();
    const batch = db.batch();
    let operationCount = 0;
    
    snapshot.forEach(doc => {
      batch.delete(doc.ref);
      operationCount++;
      
      if (operationCount >= 500) {
        batch.commit();
        operationCount = 0;
      }
    });
    
    if (operationCount > 0) {
      await batch.commit();
    }
    
    await chatRef.delete();
    
    if (unsubscribeMessages) {
      unsubscribeMessages();
      unsubscribeMessages = null;
    }
    
    localStorage.removeItem('chatPin');
    localStorage.removeItem('chatUsername');
    localStorage.removeItem('chatAvatarURL');
    
    chatPin = null;
    username = null;
    avatarURL = null;
    
    chatDiv.style.display = 'none';
    usernameForm.style.display = 'flex';
    document.getElementById('pinInput').value = '';
    document.getElementById('usernameInput').value = '';
    document.getElementById('avatarInput').value = '';
    messagesDiv.innerHTML = '';
    msgInput.value = '';
    sendBtn.disabled = true;
    
    deleteConfirmationModal.classList.remove('show');
    
    confirmDeleteBtn.disabled = false;
    confirmDeleteBtn.textContent = 'ğŸ—‘ï¸ Î”Î¹Î±Î³Ï„ÏÎ±Ï†Î® Chat';
    
    alert('âœ… Î¤Î¿ Chat Î´Î¹ÎµÎ³ÏÎ¬Ï†Î· ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!');
    
  } catch (error) {
    console.error('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï… chat:', error);
    alert('âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï… chat: ' + error.message);
    confirmDeleteBtn.disabled = false;
    confirmDeleteBtn.textContent = 'ğŸ—‘ï¸ Î”Î¹Î±Î³Ï„ÏÎ±Ï†Î® Chat';
  }
};

// Close modal with Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && deleteConfirmationModal.classList.contains('show')) {
    deleteConfirmationModal.classList.remove('show');
  }
});
</script>
</body>

</html>
